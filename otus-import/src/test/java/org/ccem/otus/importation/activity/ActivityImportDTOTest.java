package org.ccem.otus.importation.activity;

import org.ccem.otus.model.survey.activity.SurveyActivity;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.InjectMocks;
import org.powermock.modules.junit4.PowerMockRunner;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import static org.junit.Assert.*;

@RunWith(PowerMockRunner.class)
public class ActivityImportDTOTest {
    private static final String IMPORT_ACTIVITY_JSON = "{activityList:[{\"objectType\":\"Activity\",\"surveyForm\":{\"sender\":\"test@gmail.com\",\"sendingDate\":\"2017-03-08T18:43:51.599Z\",\"objectType\":\"SurveyForm\",\"surveyFormType\":\"FORM_INTERVIEW\",\"surveyTemplate\":{\"extents\":\"StudioObject\",\"objectType\":\"Survey\",\"oid\":\"dXNlclVVSUQ6W3VuZGVmaW5lZF1zdXJ2ZXlVVUlEOls5N2M4NDVmMC1mODQ3LTExZTYtOGI2NC1iZDIyZTYyYzA4YTJdcmVwb3NpdG9yeVVVSUQ6WyBOb3QgZG9uZSB5ZXQgXQ==\",\"identity\":{\"extents\":\"StudioObject\",\"objectType\":\"SurveyIdentity\",\"name\":\"ANTROPOMETRIA\",\"acronym\":\"ANTC\",\"recommendedTo\":\"\",\"description\":\"\",\"keywords\":[]},\"dataSources\":[],\"staticVariableList\":null,\"metainfo\":{\"extents\":\"StudioObject\",\"objectType\":\"SurveyMetaInfo\",\"creationDatetime\":\"2017-02-21T15:08:25.424Z\",\"otusStudioVersion\":\"\"},\"itemContainer\":[{\"unit\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Unit\",\"oid\":\"\",\"plainText\":\"cm\",\"formattedText\":\"cm\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Unit\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Unit\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}},\"label\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"01. Circunferência do Pescoço:\",\"formattedText\":\"<div>01. Circunferência do Pescoço:</div>\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}},\"metadata\":{\"extents\":\"StudioObject\",\"objectType\":\"MetadataGroup\",\"options\":[{\"extends\":\"StudioObject\",\"objectType\":\"MetadataAnswer\",\"dataType\":\"Integer\",\"value\":1,\"extractionValue\":\".Q\",\"label\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"Não quer responder\",\"formattedText\":\"Não quer responder\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}}},{\"extends\":\"StudioObject\",\"objectType\":\"MetadataAnswer\",\"dataType\":\"Integer\",\"value\":2,\"extractionValue\":\".S\",\"label\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"Não sabe\",\"formattedText\":\"Não sabe\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}}},{\"extends\":\"StudioObject\",\"objectType\":\"MetadataAnswer\",\"dataType\":\"Integer\",\"value\":3,\"extractionValue\":\".A\",\"label\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"Não se aplica\",\"formattedText\":\"Não se aplica\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}}},{\"extends\":\"StudioObject\",\"objectType\":\"MetadataAnswer\",\"dataType\":\"Integer\",\"value\":4,\"extractionValue\":\".F\",\"label\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"Não há dados\",\"formattedText\":\"Não há dados\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}}}]},\"fillingRules\":{\"extends\":\"StudioObject\",\"objectType\":\"FillingRules\",\"options\":{\"scale\":{\"data\":{\"reference\":1,\"canBeIgnored\":true},\"extends\":\"StudioObject\",\"objectType\":\"Rule\",\"validatorType\":\"scale\"},\"upperLimit\":{\"data\":{\"reference\":50,\"canBeIgnored\":true},\"extends\":\"StudioObject\",\"objectType\":\"Rule\",\"validatorType\":\"upperLimit\"},\"lowerLimit\":{\"data\":{\"reference\":20,\"canBeIgnored\":true},\"extends\":\"StudioObject\",\"objectType\":\"Rule\",\"validatorType\":\"lowerLimit\"},\"mandatory\":{\"data\":{\"reference\":true,\"canBeIgnored\":false},\"extends\":\"StudioObject\",\"objectType\":\"Rule\",\"validatorType\":\"mandatory\"},\"accept\":{\"data\":{\"reference\":true,\"canBeIgnored\":false},\"extends\":\"StudioObject\",\"objectType\":\"Rule\",\"validatorType\":\"accept\"}}},\"extents\":\"SurveyItem\",\"objectType\":\"DecimalQuestion\",\"templateID\":\"ANTC1\",\"customID\":\"PASC2\",\"dataType\":\"Decimal\"},{\"options\":[{\"extents\":\"StudioObject\",\"objectType\":\"AnswerOption\",\"dataType\":\"Integer\",\"label\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"Sim\",\"formattedText\":\"Sim\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}},\"value\":1,\"extractionValue\":\"1\"},{\"extents\":\"StudioObject\",\"objectType\":\"AnswerOption\",\"dataType\":\"Integer\",\"label\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"Não\",\"formattedText\":\"Não\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}},\"value\":2,\"extractionValue\":\"0\"}],\"label\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"Alteração do Protocolo:\",\"formattedText\":\"<div>Alteração do Protocolo:</div>\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}},\"metadata\":{\"extents\":\"StudioObject\",\"objectType\":\"MetadataGroup\",\"options\":[{\"extends\":\"StudioObject\",\"objectType\":\"MetadataAnswer\",\"dataType\":\"Integer\",\"value\":1,\"extractionValue\":\".Q\",\"label\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"Não quer respondern\",\"formattedText\":\"<div>Não quer responder</div>\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}}},{\"extends\":\"StudioObject\",\"objectType\":\"MetadataAnswer\",\"dataType\":\"Integer\",\"value\":2,\"extractionValue\":\".S\",\"label\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"Não sabe\",\"formattedText\":\"Não sabe\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}}},{\"extends\":\"StudioObject\",\"objectType\":\"MetadataAnswer\",\"dataType\":\"Integer\",\"value\":3,\"extractionValue\":\".A\",\"label\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"Não se aplica\",\"formattedText\":\"Não se aplica\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}}},{\"extends\":\"StudioObject\",\"objectType\":\"MetadataAnswer\",\"dataType\":\"Integer\",\"value\":4,\"extractionValue\":\".F\",\"label\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"Não há dados\",\"formattedText\":\"Não há dados\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}}}]},\"fillingRules\":{\"extends\":\"StudioObject\",\"objectType\":\"FillingRules\",\"options\":{\"mandatory\":{\"data\":{\"reference\":true,\"canBeIgnored\":false},\"extends\":\"StudioObject\",\"objectType\":\"Rule\",\"validatorType\":\"mandatory\"}}},\"extents\":\"SurveyItem\",\"objectType\":\"SingleSelectionQuestion\",\"templateID\":\"ANTC2\",\"customID\":\"ANTCalt\",\"dataType\":\"Integer\"},{\"label\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"Alteração do Protocolo - Qual:&nbsp; \",\"formattedText\":\"<div><span style='letter-spacing: 0.01em;'>Alteração do Protocolo - Qual:&nbsp;</span><br></div>\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}},\"metadata\":{\"extents\":\"StudioObject\",\"objectType\":\"MetadataGroup\",\"options\":[]},\"fillingRules\":{\"extends\":\"StudioObject\",\"objectType\":\"FillingRules\",\"options\":{\"minLength\":{\"data\":{\"reference\":1,\"canBeIgnored\":true},\"extends\":\"StudioObject\",\"objectType\":\"Rule\",\"validatorType\":\"minLength\"},\"mandatory\":{\"data\":{\"reference\":true,\"canBeIgnored\":false},\"extends\":\"StudioObject\",\"objectType\":\"Rule\",\"validatorType\":\"mandatory\"},\"maxLength\":{\"data\":{\"reference\":300,\"canBeIgnored\":true},\"extends\":\"StudioObject\",\"objectType\":\"Rule\",\"validatorType\":\"maxLength\"}}},\"extents\":\"SurveyItem\",\"objectType\":\"TextQuestion\",\"templateID\":\"ANTC3\",\"customID\":\"ANTCaltq\",\"dataType\":\"String\"},{\"value\":{\"ptBR\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"Obrigado(a).\",\"formattedText\":\"<i>Obrigado(a).</i>\"},\"enUS\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"},\"esES\":{\"extends\":\"StudioObject\",\"objectType\":\"Label\",\"oid\":\"\",\"plainText\":\"\",\"formattedText\":\"\"}},\"extents\":\"SurveyItem\",\"objectType\":\"TextItem\",\"templateID\":\"ANTC4\",\"customID\":\"ANTCZ\",\"dataType\":\"String\"}],\"navigationList\":[{\"extents\":\"SurveyTemplateObject\",\"objectType\":\"Navigation\",\"origin\":\"BEGIN NODE\",\"index\":0,\"inNavigations\":[],\"isDefault\":false,\"routes\":[{\"extents\":\"SurveyTemplateObject\",\"objectType\":\"Route\",\"origin\":\"BEGIN NODE\",\"destination\":\"ANTC1\",\"name\":\"BEGIN NODE_ANTC1\",\"isDefault\":true,\"conditions\":[]}]},{\"extents\":\"SurveyTemplateObject\",\"objectType\":\"Navigation\",\"origin\":\"END NODE\",\"index\":1,\"inNavigations\":[{\"origin\":\"ANTC4\"}],\"isDefault\":false,\"routes\":[]},{\"extents\":\"SurveyTemplateObject\",\"objectType\":\"Navigation\",\"origin\":\"ANTC1\",\"index\":2,\"inNavigations\":[{\"origin\":\"BEGIN NODE\"}],\"isDefault\":false,\"routes\":[{\"extents\":\"SurveyTemplateObject\",\"objectType\":\"Route\",\"origin\":\"ANTC1\",\"destination\":\"ANTC2\",\"name\":\"ANTC1_ANTC2\",\"isDefault\":true,\"conditions\":[]}]},{\"extents\":\"SurveyTemplateObject\",\"objectType\":\"Navigation\",\"origin\":\"ANTC2\",\"index\":3,\"inNavigations\":[{\"origin\":\"ANTC1\"}],\"isDefault\":false,\"routes\":[{\"extents\":\"SurveyTemplateObject\",\"objectType\":\"Route\",\"origin\":\"ANTC2\",\"destination\":\"ANTC4\",\"name\":\"ANTC2_ANTC4\",\"isDefault\":true,\"conditions\":[]},{\"extents\":\"SurveyTemplateObject\",\"objectType\":\"Route\",\"origin\":\"ANTC2\",\"destination\":\"ANTC3\",\"name\":\"ANTC2_ANTC3\",\"isDefault\":false,\"conditions\":[{\"extents\":\"StudioObject\",\"objectType\":\"RouteCondition\",\"name\":\"ROUTE_CONDITION_0\",\"rules\":[{\"extents\":\"SurveyTemplateObject\",\"objectType\":\"Rule\",\"when\":\"ANTC2\",\"operator\":\"equal\",\"answer\":\"1\",\"isMetadata\":false}]}]}]},{\"extents\":\"SurveyTemplateObject\",\"objectType\":\"Navigation\",\"origin\":\"ANTC3\",\"index\":4,\"inNavigations\":[{\"origin\":\"ANTC2\"}],\"isDefault\":false,\"routes\":[{\"extents\":\"SurveyTemplateObject\",\"objectType\":\"Route\",\"origin\":\"ANTC3\",\"destination\":\"ANTC4\",\"name\":\"ANTC3_ANTC4\",\"isDefault\":true,\"conditions\":[]}]},{\"extents\":\"SurveyTemplateObject\",\"objectType\":\"Navigation\",\"origin\":\"ANTC4\",\"index\":5,\"inNavigations\":[{\"origin\":\"ANTC3\"},{\"origin\":\"ANTC2\"}],\"isDefault\":false,\"routes\":[{\"extents\":\"SurveyTemplateObject\",\"objectType\":\"Route\",\"origin\":\"ANTC4\",\"destination\":\"END NODE\",\"name\":\"ANTC4_END NODE\",\"isDefault\":true,\"conditions\":[]}]}]},\"isDiscarded\":false,\"version\":1},\"mode\":\"ONLINE\",\"category\":{\"name\":\"C2\",\"objectType\":\"ActivityCategory\",\"label\":\"Repetição\",\"disabled\":false,\"isDefault\":false},\"participantData\":{\"recruitmentNumber\":5005283,\"name\":\"RITA DE CÁSSIA PEREIRA\",\"sex\":\"F\",\"birthdate\":{\"objectType\":\"ImmutableDate\",\"value\":\"1975-10-22 00:00:00.000\"},\"fieldCenter\":{\"name\":\"Rio Grande do Sul\",\"code\":5,\"acronym\":\"RS\",\"country\":null,\"state\":\"RS\",\"address\":null,\"complement\":null,\"zip\":null,\"phone\":null}},\"interviews\":[],\"fillContainer\":{\"fillingList\":[]},\"statusHistory\":[{\"objectType\":\"ActivityStatus\",\"name\":\"CREATED\",\"date\":\"2017-12-15T13:16:56.710Z\",\"user\":{\"name\":\"Diogo\",\"surname\":\"Ferreira\",\"phone\":\"5193034655\",\"email\":\"diogo.rosas.ferreira@gmail.com\"}}],\"isDiscarded\":false,\"navigationTracker\":{\"objectType\":\"NavigationTracker\",\"items\":[{\"objectType\":\"NavigationTrackingItem\",\"id\":\"ANTC1\",\"state\":\"NOT_VISITED\",\"previous\":null,\"inputs\":[],\"outputs\":[\"ANTC2\"]},{\"objectType\":\"NavigationTrackingItem\",\"id\":\"ANTC2\",\"state\":\"NOT_VISITED\",\"previous\":null,\"inputs\":[\"ANTC1\"],\"outputs\":[\"ANTC4\",\"ANTC3\"]},{\"objectType\":\"NavigationTrackingItem\",\"id\":\"ANTC3\",\"state\":\"NOT_VISITED\",\"previous\":null,\"inputs\":[\"ANTC2\"],\"outputs\":[\"ANTC4\"]},{\"objectType\":\"NavigationTrackingItem\",\"id\":\"ANTC4\",\"state\":\"NOT_VISITED\",\"previous\":null,\"inputs\":[\"ANTC3\",\"ANTC2\"],\"outputs\":[]}],\"lastVisitedIndex\":null}}]}";

    @InjectMocks
    private ActivityImportDTO activityImportDTO;
    private List<SurveyActivity> listSurveyActivity;

    @Before
    public void setUp() {
        listSurveyActivity = new ArrayList();
        activityImportDTO = new ActivityImportDTO();
        activityImportDTO = ActivityImportDTO.deserialize(IMPORT_ACTIVITY_JSON);
        listSurveyActivity = Arrays.asList(activityImportDTO.getActivityList().get(0));
    }

    @Test
    public void deserialize_method_should_convert_JsonString_to_objectModel() {
        assertTrue(ActivityImportDTO.deserialize(IMPORT_ACTIVITY_JSON) instanceof ActivityImportDTO);
    }

    @Test
    public void getActivityList_method_should_return_activityList() {
        assertEquals(listSurveyActivity.get(0), activityImportDTO.getActivityList().get(0));
    }
}